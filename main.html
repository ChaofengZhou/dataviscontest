<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <style>

        h1 {
            font-size: 18pt;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
        }

        div {
            float: left;
        }

        a {
            text-decoration: none;
        }

        /* unvisited link */
        a:link {
            color: green;
        }

        /* visited link */
        a:visited {
            color: green;
        }

        /* mouse over link */
        a:hover {
            color: red;
        }

        /* selected link */
        a:active {
            color: yellow;
        }

        /*pop out text box*/
        #d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
            position: absolute;
            display: none;
        }

        /*story panel div*/
        #story {
            width: 23%;
            margin-top: -1%;
        }

        /*vis panel div*/
        #content {
            width: 77%;
        }

        /*story  paragraph text*/
        p {

            font-size: 12px;
        }

        /*ACT score text*/
        .score_text {
            font-size: 12px;
        }

        /*stay or leave text: stay , leave*/
        .stay_leave_text {
            font-size: 12px;
        }

        /* main title:Major Category, Planned Major, ACT, 1 Year Major, 2 Year Major*/
        .main-title {
            font-size: 14px;
        }

        /* gender text: male and female*/
        .gender-title {
            font-size: 10px;
        }

        /*fit text: good, normal, bad*/
        .fit {
            color: #FF0000;
            font-size: 8px;
        }

        /*collge name :Humanity, Health...*/
        .college_name {
            color: #FF0000;
            font-size: 12px;
        }

    </style>
</head>

<body>
<div align="left" id="story">
    <h1 align="center">Why and when do Students change Majors?</h1>
    <fieldset>
        <legend>
            Introduction
        </legend>
        <p>
            This is a contribution to the <a href="http://vacommunity.org/ieeevpg/2015/index.html">IEEE VGTC VPG
            Data-Visualization Contest</a>. The goal of the contest is to understand perceived vs. actual student
            interest in majors and to understand whether students that are determined a good fit for their major stay in
            it more commonly than those who are not.
        </p>
    </fieldset>
    <fieldset>
        <legend>
            Data
        </legend>
        <p>
            The data contains information about planned majors (in high school), actual majors declared in the first and
            second year of college, scores that capture the fit of the student to the major, and a general ability
            score, in addition to gender.
        </p>
    </fieldset>

    <fieldset>
        <legend>
            Visualization
        </legend>
        <p>
            Our visualization is a combination of Parallel Sets and Mosaic Plots. The
            User can choose to highlight a major in the major category column. A path flow will start from the
            college block that major belong to in planned major column flow to ACT bar.
            User can see the act score distribution in this major.
            Then it come with the first stay leave bar, which will show user how many student stay or leave this major.
            The blue flow path show that percentage of student stay in this major and the red flow path
            show the percentage of leave student. The following 1 year major column will show what college
            those leave student will switch to. Once it come to the second year, the second stay and leave bar
            will tell user who will persist in their planned major in the sophomore year or which college
            they may switch to.
        </p>
    </fieldset>
    <fieldset>
        <legend>
            Highlights
        </legend>
        <p>

            <a href="#" id="example1">Health Sci. & Techno.</a> has the maximum outflux in the first year. <br>
            <a href="#" id="example2">Arts: Visual & Performing</a> Student has high percent fit well in this major
        </p>
    </fieldset>

    <fieldset>
        <legend>
            About
        </legend>
        <p>
            This visualization technique was developed by <a href="#">Zhimin Li</a> with guidance from <a
                href="http://alexander-lex.net/" target="_blank">Alexander Lex</a> at the <a href="http://cs.utah.edu">University
            of Utah</a>.
        </p>
    </fieldset>
</div>
<div align="right" id="content">
    <svg id="chart_title"></svg>
    <svg id="chart">
        <svg id="majorTitle"></svg>
        <svg id="act"></svg>
        <svg id="pre_major"></svg>
        <svg id="fresh"></svg>
        <svg id="fre_major"></svg>
        <svg id="sopho"></svg>
        <svg id="sop_major"></svg>
        <svg id="majorpath"></svg>
    </svg>
</div>

<div id="d3-tip">

</div>
<script>
    var activeColor;

    //tree structure contain all the information of the data set.
    var data_tree;

    // the number of people in each ACT score range
    var actcat;

    //contain the gender and limfit information of a college
    var pre_college,
            fre_college,
            sop_college;

    var fre_health,
            fre_business,
            fre_humanity,
            fre_education,
            fre_engineer,
            fre_science,
            fre_college_switch;

    var sop_health,
            sop_business,
            sop_humanity,
            sop_education,
            sop_engineer,
            sop_science,
            sop_college_switch;

    var ACT;

    var pre_major_switch;
    var fre_major_switch;

    var fre_switch;
    //if the student change their major in freshman
    var sop_switch;
    //change their major in sophomore.
    var pre_department;
    var fre_department;
    var sop_department;

    // contain gender informaiton
    var pre_gender;
    var fre_gender;
    var sop_gender;

    // contain the number of people in each major
    var pre_major;
    var fre_major;
    var sop_major;

    // contain the number of good/moderate/bad student in each major
    var pre_major_imfit;
    var fre_major_imfit;
    var sop_major_imfit;

    // contain the year type information in each department
    var fre_yr;
    var sop_yr;

    var major_name;
    var department_name;

    //the tree structure information about college-department
    var department_major_tree;

    var nums;
    //the number of data item.

    var margin = {
                top: 40,
                right: 10,
                bottom: 30,
                left: window.innerWidth / 4
            },
            width = window.innerWidth - margin.right - margin.left,
            height = window.innerHeight - margin.top - margin.bottom;

    var pre_x = width / 8 + 0.045 * width + width / 24;
    var pre_act_x = width / 8 * 2 + width / 24 + 0.045 * width * 2;
    var pre_s_l_x = width / 8 * 2 + width / 24 + 0.045 * width * 3 + width / 29;
    var fre_x = width / 8 * 2 + width / 24 * 2 + 0.045 * width * 4 + width / 29 * 2;
    var fre_s_l_x = width / 8 * 3 + width / 24 * 2 + 0.045 * width * 5 + width / 29 * 2;
    var sop_x = width / 8 * 3 + width / 24 * 2 + 0.045 * width * 7 + width / 29 * 3;

    d3.select("#chart").attr("width", width + 2).attr("height", height).attr("transform", "translate(200, 0)");

    d3.text("data.csv", function (unparseData) {
        //intial the vis data.
        var data = d3.csv.parseRows(unparseData);
        nums = dataInitialization(data);

        var act_score_nums = [];
        var act_score_text = [];
        for (key in actcat) {
            act_score_nums.push(actcat[key]);
            act_score_text.push(key);
        }

        var dep_nums = [];
        for (key in pre_department) {
            dep_nums.push(pre_department[key]);
        }
        drawMajorTitle(dep_nums);
        /************************************************************************
         pre major info
         ************************************************************************/
        var temp = 0;
        var college_major_name;
        for (key in pre_college) {
            college_major_name = department_major_tree[key];
            drawCollegeMosaicPlot("pre_major", key, pre_college[key], pre_x, temp, width / 8, d3.sum(pre_college[key]) / nums * (height - 25), college_major_name, pre_major);
            temp += d3.sum(pre_college[key]) / nums * (height - 25) + 5;
        }

        drawFeatureBar("act", act_score_nums, act_score_text, pre_act_x, ACT);
        drawStayOrLeaveBar("fresh", [fre_switch.stay, fre_switch.leave], pre_s_l_x, pre_major_switch);

        /************************************************************************
         fresh man major info
         ************************************************************************/
        var temp = 0;
        var college_major_name = [];
        for (key in pre_major) {
            college_major_name.push(key);
        }
        for (key in fre_college) {
            drawCollegeMosaicPlot("fre_major", key, fre_college[key], fre_x, temp, width / 8, d3.sum(fre_college[key]) / nums * (height - 25), college_major_name, fre_college_switch[key]);
            temp += d3.sum(fre_college[key]) / nums * (height - 25) + 5;
        }

        /************************************************************************
         sophomore man major info
         ************************************************************************/

        temp = 0;

        for (key in sop_college) {
            drawCollegeMosaicPlot("sop_major", key, sop_college[key], sop_x, temp, width / 8, d3.sum(sop_college[key]) / nums * (height - 25), college_major_name, sop_college_switch[key]);
            temp += d3.sum(sop_college[key]) / nums * (height - 25) + 5;
        }

        var value = [];
        for (key in actcat) {
            value.push(actcat[key]);
        }

        drawStayOrLeaveBar("sopho", [sop_switch.stay, sop_switch.leave], fre_s_l_x, fre_major_switch);

        drawMajorFlowPath();
        drawLable();
        tipToolevent();
    });

    function drawLable() {
        var p_x = pre_x + width / 8;
        var p_d = pre_x;
        var f_x = fre_x;
        var f_b = fre_x + width / 8;
        var s_x = sop_x;
        var s_b = sop_x + width / 8;
        var act_x_f = pre_act_x;
        var act_x_b = pre_act_x + width / 29;
        var p_s_l_bar_f = pre_s_l_x;
        var p_s_l_bar_b = pre_s_l_x + width / 29;
        var f_s_l_bar_f = fre_s_l_x;
        var f_s_l_bar_b = f_s_l_bar_f + width / 29;

        var p_l_x = pre_x - width / 30;
        var f_l_x = fre_x - width / 30;
        var s_l_x = sop_x - width / 30;

        var chart = d3.select("#chart_title").attr("height", 50).attr("width", width);

        chart.append("svg").selectAll("text").data(["Major Category"]).enter().append("text").text(function (d, index) {
            return d;
        }).attr("class", function (d, index) {
            return "main-title";
        }).attr("x", function (d, index) {
            return width / 8 / 2;
        }).attr("y", function (d, index) {
            return 10;
        }).attr("fill", "black").attr("font-size", function (d, index) {
            return 14;
        })
                .attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("alignment-baseline", "middle");

        chart.append("svg").selectAll("path").data([1, 2]).enter().append("path").attr("d", function (d, index) {
            if (index == 0)
                return "M" + p_d + " " + 40 + " L" + (p_d + 5) + " " + 35 + " L" + (p_d + 5) + " 45" + " Z";
            else
                return "M" + p_x + " " + 40 + " L" + (p_x - 5) + " " + 35 + " L" + (p_x - 5) + " 45" + " Z";
        }).attr("fill", function (d, index) {
            if (index == 0)
                return "rgb(0,69,41)";
            else
                return "rgb(174,1,126)";
        });

        chart.append("svg").selectAll("text").data(["Planned Major", "Male", "Female"]).enter().append("text").text(function (d, index) {
            return d;
        }).attr("class", function (d, index) {
            if (index == 0)
                return "main-title";
            else
                return "gender-title";
        }).attr("x", function (d, index) {
            if (index == 0)
                return p_x - width / 8 / 2;
            else if (index == 1)
                return p_x - width / 8 * 3 / 4;
            else
                return p_x - width / 8 / 4;
        }).attr("y", function (d, index) {
            if (index == 0)
                return 10;
            else
                return 40;
        }).attr("fill", "black").attr("font-size", function (d, index) {
            if (index == 0)
                return 14;
            else
                return 10;

        }).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("alignment-baseline", "middle");
        chart.append("svg").append("text").text("ACT").attr("x", act_x_f + width / 2 / 29).attr("y", 10).attr("fill", "black").attr("font-size", 14).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle")
                .attr("alignment-baseline", "middle").attr("class", function (d, index) {
                    return "main-title";
                });

        chart.append("svg").selectAll("path").data([1, 2]).enter().append("path").attr("d", function (d, index) {
            if (index == 0)
                return "M" + f_x + " " + 40 + " L" + (f_x + 5) + " " + 35 + " L" + (f_x + 5) + " 45" + " Z";
            else
                return "M" + f_b + " " + 40 + " L" + (f_b - 5) + " " + 35 + " L" + (f_b - 5) + " 45" + " Z";
        }).attr("fill", function (d, index) {
            if (index == 0)
                return "rgb(0,69,41)";
            else
                return "rgb(174,1,126)";
        });

        chart.append("svg").selectAll("text").data(["1 Year Major", "Male", "Female"]).enter().append("text").text(function (d, index) {
            return d;
        }).attr("class", function (d, index) {
            if (index == 0)
                return "main-title";
            else
                return "gender-title";
        }).attr("x", function (d, index) {
            if (index == 0)
                return f_b - width / 8 / 2;
            else if (index == 1)
                return f_b - width / 8 * 3 / 4;
            else
                return f_b - width / 8 / 4;
        }).attr("y", function (d, index) {
            if (index == 0)
                return 10;
            else
                return 40;
        }).attr("fill", "black").attr("font-size", function (d, index) {
            if (index == 0)
                return 14;
            else
                return 10;
        }).attr("alignment-baseline", "middle").attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("alignment-baseline", "middle");

        chart.append("svg").selectAll("path").data([1, 2]).enter().append("path").attr("d", function (d, index) {
            if (index == 0)
                return "M" + s_x + " " + 40 + " L" + (s_x + 5) + " " + 35 + " L" + (s_x + 5) + " 45" + " Z";
            else
                return "M" + (s_b - 2) + " " + 40 + " L" + (s_b - 7) + " " + 35 + " L" + (s_b - 7) + " 45" + " Z";
        }).attr("fill", function (d, index) {
            if (index == 0)
                return "rgb(0,69,41)";
            else
                return "rgb(174,1,126)";
        });
        chart.append("svg").selectAll("text").data(["2 Year Major", "Male", "Female"]).enter().append("text").text(function (d, index) {
            return d;
        }).attr("class", function (d, index) {
            if (index == 0)
                return "main-title";
            else
                return "gender-title";
        }).attr("x", function (d, index) {
            if (index == 0)
                return s_b - width / 8 / 2;
            else if (index == 1)
                return s_b - width / 8 * 3 / 4;
            else
                return s_b - width / 8 / 4;
        }).attr("y", function (d, index) {
            if (index == 0)
                return 10;
            else
                return 40;
        }).attr("fill", "black").attr("font-size", function (d, index) {
            if (index == 0)
                return 14;
            else
                return 10;
        }).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("alignment-baseline", "middle");

    }

    function drawMajorFlowPath() {
        //x coordination of each component
        var p_x = pre_x + width / 8;
        var f_x = fre_x - width / 24;
        var f_b = fre_x + width / 8;
        var s_x = sop_x - width / 24;
        var act_x_f = pre_act_x;
        var act_x_b = pre_act_x + width / 29;
        var p_s_l_bar_f = pre_s_l_x;
        var p_s_l_bar_b = pre_s_l_x + width / 29;
        var f_s_l_bar_f = fre_s_l_x;
        var f_s_l_bar_b = f_s_l_bar_f + width / 29;

        var dep_y = 0;
        var dep_h = 0;
        var dep_sum = 0;
        var maj_sum;
        var act_sum;
        var majors;
        var i;
        var j;
        var data;
        var pathset = [];
        var path;
        var major_h;
        var name;

        //from pre major to act score
        var act_value = $.map(actcat, function (value, index) {
            return [value];
        });
        for (key in pre_department) {
            dep_sum += pre_department[key] / nums * (height - 25);
            dep_y = dep_sum - pre_department[key] / nums * (height - 25);
            dep_sum += 5;

            //draw major flow
            maj_sum = 0;
            majors = department_major_tree[key];
            for (i = 0; i < majors.length; i++) {

                //draw flow path from pre major to act score bar
                data = ACT[majors[i]];
                act_sum = 0;
                pathset = [];
                dep_h = d3.sum(data) / nums * (height - 25);
                for (j = 0; j < data.length / 2; j++) {
                    path = "M";
                    maj_sum += dep_h * (data[j * 2] + data[j * 2 + 1]) / d3.sum(data);
                    act_sum += act_value[j] / nums * height;
                    path += p_x + " " + (dep_y + maj_sum - dep_h * (data[j * 2] + data[j * 2 + 1]) / d3.sum(data)) + " L" + act_x_f + " " + (act_sum - (data[j * 2] + data[j * 2 + 1] ) / nums * height) + " L" + act_x_f + " " + (act_sum) + " L" + p_x + " " + (dep_y + maj_sum) + " Z";
                    pathset.push(path);
                }
                name = majors[i];
                name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                    return pathset[index];
                }).attr("fill", "rgb(153, 204, 255)").attr("fill-opacity", function (d, index) {
                    return 0.8;
                }).on("mouseover", function (d, index) {
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    $("#d3-tip").show();
                    for (key in pre_major) {
                        if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                            continue;
                        else
                            d3.select("#d3-tip").html(key + "<br>" + " population:" + (ACT[key][index * 2] + ACT[key][index * 2 + 1]) + "<br>" + "% in major:" + ((ACT[key][index * 2] + ACT[key][index * 2 + 1]) / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + ((ACT[key][index * 2] + ACT[key][index * 2 + 1]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                    }
                }).on("mouseout", function (d, index) {
                    d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                    $("#d3-tip").hide();
                });
                ;

                //draw flow path from act score bar to stay or leave bar
                act_sum = 0;
                pathset = [];
                var s_maj_sum = pre_major_switch[majors[i]][0] / nums * height;
                var l_maj_sum = pre_major_switch[majors[i]][1] / nums * height;
                for (j = 0; j < data.length; j++) {
                    path = "M";

                    if (j % 2 == 0) {
                        act_sum += act_value[j / 2] / nums * height;
                        path += act_x_b + " " + (act_sum - (data[j] + data[j + 1]) / nums * height) + " L" + p_s_l_bar_f + " " + (fre_switch.stay / nums * height - s_maj_sum) + " L" + p_s_l_bar_f + " " + (fre_switch.stay / nums * height - s_maj_sum + data[j] / nums * height) + " L" + act_x_b + " " + (act_sum - (data[j + 1]) / nums * height);
                        s_maj_sum -= data[j] / nums * height;
                    } else {
                        path += act_x_b + " " + (act_sum - (data[j]) / nums * height) + " L" + p_s_l_bar_f + " " + (height - l_maj_sum) + " L" + p_s_l_bar_f + " " + (height - l_maj_sum + data[j] / nums * height) + " L" + act_x_b + " " + act_sum;
                        l_maj_sum -= data[j] / nums * height;
                    }
                    pathset.push(path);
                }

                d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                    return pathset[index];
                }).attr("fill", function (d, index) {
                    if (index % 2 == 0)
                        return "rgb(153, 204, 255)";
                    else
                        return "rgb(255, 125, 92)";
                }).attr("fill-opacity", function (d, index) {
                    return 0.8;
                }).on("mouseover", function (d, index) {
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    $("#d3-tip").show();
                    for (key in pre_major) {
                        if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                            continue;
                        else
                            d3.select("#d3-tip").html(key + "<br>" + " population:" + ACT[key][index] + "<br>" + "% in major:" + (ACT[key][index] / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (ACT[key][index] / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                    }
                }).on("mouseout", function (d, index) {
                    d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                    $("#d3-tip").hide();
                });
                ;

                //draw flow path from stay or leave bar to fre_major
                pathset = [];

                //stay path
                path = "M";
                path += p_s_l_bar_b + " " + (fre_switch.stay / nums * height - pre_major_switch[majors[i]][0] / nums * height) + " L" + f_x + " " + getMajor_Y_Location(majors[i], fre_department, fre_major) + " L" + f_x + " " + (getMajor_Y_Location(majors[i], fre_department, fre_major) + d3.sum(fre_college_switch[key][majors[i]]) / nums * (height - 25)) + " L" + p_s_l_bar_b + " " + (fre_switch.stay / nums * height) + " Z";
                pathset.push(path);
                d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                    return pathset[index];
                }).attr("fill", function (d, index) {
                    if (index == 0)
                        return "rgb(153, 204, 255)";
                    else
                        return "rgb(255, 125, 92)";
                }).attr("fill-opacity", function (d, index) {
                    return 0.8;
                }).on("mouseover", function (d, index) {
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    $("#d3-tip").show();
                    for (key in pre_major) {
                        if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                            continue;
                        else
                            d3.select("#d3-tip").html(key + "<br>" + " population:" + d3.sum(fre_college_switch[getDepartment(key)][key]) + "<br>" + "% in major:" + (d3.sum(fre_college_switch[getDepartment(key)][key]) / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d3.sum(fre_college_switch[getDepartment(key)][key]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                    }
                }).on("mouseout", function (d, index) {
                    d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                    $("#d3-tip").hide();
                });
                pathset = [];

                //leave path
                var fre_dep_sum = 0;
                var fre_dep_mar_sum = 0;
                for (k in department_major_tree) {
                    path = "M";
                    if (k == getDepartment(majors[i])) {
                        fre_dep_sum += fre_department[k] / nums * (height - 25) + 5;
                    } else {
                        var temp = d3.sum(fre_college_switch[k][majors[i]]) / nums * height;
                        fre_dep_mar_sum += temp;
                        path += p_s_l_bar_b + " " + (height - pre_major_switch[majors[i]][1] / nums * height + fre_dep_mar_sum - temp) + " L" + f_x + " " + fre_dep_sum + " L" + f_x + " " + (fre_dep_sum + temp) + " L" + p_s_l_bar_b + " " + (height - pre_major_switch[majors[i]][1] / nums * height + fre_dep_mar_sum) + " Z";
                        pathset.push(path);
                        fre_dep_sum += fre_department[k] / nums * (height - 25) + 5;
                    }

                }

                d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                    return pathset[index];
                }).attr("fill", function (d, index) {
                    return "rgb(255, 125, 92)";
                }).attr("fill-opacity", function (d, index) {
                    return 0.8;
                }).on("mouseover", function (d, index) {
                    d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    $("#d3-tip").show();

                    for (key in pre_major) {
                        if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                            continue;
                        else {
                            var i = 0;
                            for (; i < department_name.length; i++)
                                if (department_name[i] == getDepartment(key))
                                    break;
                            if (index >= i)
                                index++;
                            d3.select("#d3-tip").html(key + "<br>" + " population:" + d3.sum(fre_college_switch[department_name[index]][key]) + "<br>" + "% in major:" + (d3.sum(fre_college_switch[department_name[index]][key]) / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d3.sum(fre_college_switch[department_name[index]][key]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");
                        }
                    }
                }).on("mouseout", function (d, index) {
                    d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                    $("#d3-tip").hide();
                });

                //draw flow path from fre major to sop stay or leave bar.
                {
                    pathset = [];

                    path = "M";
                    path += f_b + " " + getMajor_Y_Location(majors[i], fre_department, fre_major) + " L" + f_s_l_bar_f + " " + (sop_switch.stay - fre_major_switch[majors[i]][0]) / nums * height + " L" + f_s_l_bar_f + " " + sop_switch.stay / nums * height + " L" + f_b + " " + (getMajor_Y_Location(majors[i], fre_department, fre_major) + fre_major_switch[majors[i]][0] / nums * height) + " Z";

                    pathset.push(path);

                    path = "M";
                    path += f_b + " " + (getMajor_Y_Location(majors[i], fre_department, fre_major) + fre_major_switch[majors[i]][0] / nums * height) + " L" + f_s_l_bar_f + " " + (height - fre_major_switch[majors[i]][1] / nums * height) + " L" + f_s_l_bar_f + " " + height + " L" + f_b + " " + (getMajor_Y_Location(majors[i], fre_department, fre_major) + d3.sum(fre_major_switch[majors[i]]) / nums * height) + " Z";
                    pathset.push(path);

                    d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                        return pathset[index];
                    }).attr("fill", function (d, index) {
                        if (index == 0)
                            return "rgb(153, 204, 255)";
                        else
                            return "rgb(255, 125, 92)";
                    }).attr("fill-opacity", function (d, index) {
                        return 0.8;
                    }).on("mouseover", function (d, index) {
                        d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                    }).on("mouseout", function (d, index) {
                        d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                    });
                    ;
                }

                //draw flow path from stay or leave bar to sop major
                {
                    //draw flow path from stay or leave bar to fre_major
                    pathset = [];

                    //stay path
                    path = "M";
                    path += f_s_l_bar_b + " " + (sop_switch.stay / nums * height - fre_major_switch[majors[i]][0] / nums * height) + " L" + s_x + " " + getMajor_Y_Location(majors[i], sop_department, sop_major) + " L" + s_x + " " + (getMajor_Y_Location(majors[i], sop_department, sop_major) + d3.sum(sop_college_switch[key][majors[i]]) / nums * (height - 25)) + " L" + f_s_l_bar_b + " " + (sop_switch.stay / nums * height) + " Z";
                    pathset.push(path);
                    d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                        return pathset[index];
                    }).attr("fill", function (d, index) {
                        if (index == 0)
                            return "rgb(153, 204, 255)";
                        else
                            return "rgb(255, 125, 92)";
                    }).attr("fill-opacity", function (d, index) {
                        return 0.8;
                    }).on("mouseover", function (d, index) {
                        d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                        $("#d3-tip").show();
                        for (key in pre_major) {
                            if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                                continue;
                            else
                                d3.select("#d3-tip").html(key + "<br>" + " population:" + d3.sum(sop_college_switch[getDepartment(key)][key]) + "<br>" + "% in major:" + (d3.sum(sop_college_switch[getDepartment(key)][key]) / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d3.sum(sop_college_switch[getDepartment(key)][key]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");
                        }
                    }).on("mouseout", function (d, index) {
                        d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                        $("#d3-tip").hide();
                    });
                    pathset = [];

                    //leave path
                    var sop_dep_sum = 0;
                    var sop_dep_mar_sum = 0;
                    for (k in department_major_tree) {
                        path = "M";
                        if (k == getDepartment(majors[i])) {
                            sop_dep_sum += sop_department[k] / nums * (height - 25) + 5;
                        } else {
                            var temp = d3.sum(sop_college_switch[k][majors[i]]) / nums * height;
                            sop_dep_mar_sum += temp;
                            path += f_s_l_bar_b + " " + (height - fre_major_switch[majors[i]][1] / nums * height + sop_dep_mar_sum - temp) + " L" + s_x + " " + sop_dep_sum + " L" + s_x + " " + (sop_dep_sum + temp) + " L" + f_s_l_bar_b + " " + (height - fre_major_switch[majors[i]][1] / nums * height + sop_dep_mar_sum) + " Z";
                            pathset.push(path);
                            sop_dep_sum += sop_department[k] / nums * (height - 25) + 5;
                        }

                    }

                    d3.select("#majorpath").append("svg").attr("class", name).attr("display", "none").selectAll("path").data(pathset).enter().append("path").attr("d", function (d, index) {
                        return pathset[index];
                    }).attr("fill", function (d, index) {
                        return "rgb(255, 125, 92)";
                    }).attr("fill-opacity", function (d, index) {
                        return 0.8;
                    }).on("mouseover", function (d, index) {
                        d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                        $("#d3-tip").show();

                        for (key in pre_major) {
                            if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                                continue;
                            else {
                                var i = 0;
                                for (; i < department_name.length; i++)
                                    if (department_name[i] == getDepartment(key))
                                        break;
                                if (index >= i)
                                    index++;
                                d3.select("#d3-tip").html(key + "<br>" + " population:" + d3.sum(sop_college_switch[department_name[index]][key]) + "<br>" + "% in major:" + (d3.sum(sop_college_switch[department_name[index]][key]) / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d3.sum(sop_college_switch[department_name[index]][key]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");
                            }
                        }
                    }).on("mouseout", function (d, index) {
                        d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                        $("#d3-tip").hide();
                    });
                    ;
                }
            }

        }

    }

    // id			indicate the block to show this plot
    // college_name			the name of the department
    // data	the 	female/male, good/moderate/bad percentage of the department.
    // x			the top left x coordinate of the plot
    // y			the top left y coordinate of the plot.
    // w			the width of the plot
    // h			the height of the plot
    // major_data	each major data under the college
    function drawCollegeMosaicPlot(id, college_name, data, x, y, w, h, college_major_name, data_container) {

        d3.select("#" + id).append("svg").selectAll("rect").data(data).enter().append("rect").attr("x", function (d, index) {
            if (index % 2 == 0)
                return x;
            else
                return data[index - 1] / (data[index - 1] + data[index]) * w + x;
        }).attr("width", function (d, index) {
            if (index % 2 == 0)
                return data[index] / (data[index + 1] + data[index]) * w;
            else
                return data[index] / (data[index - 1] + data[index]) * w;
        }).attr("y", function (d, index) {
            if (index / 2 < 1)
                return y;
            else if (index / 2 < 2)
                return (data[0] + data[1]) / d3.sum(data) * h + y;
            else
                return h - (data[4] + data[5]) / d3.sum(data) * h + y;
        }).attr("height", function (d, index) {
            if (index / 2 < 1)
                return (data[0] + data[1]) / d3.sum(data) * h;
            else if (index / 2 < 2)
                return (data[2] + data[3]) / d3.sum(data) * h;
            else
                return (data[4] + data[5]) / d3.sum(data) * h;
        }).attr("fill-opacity", 0.1).attr("stroke-width", 1).attr("stroke", "gray").attr("stroke-opacity", 0.9).attr("fill", "gray");

        var major_data;
        var name;
        for (var i = 0; i < college_major_name.length; i++) {
            name = college_major_name[i];
            major_data = data_container[name];
            name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            d3.select("#" + id).append("svg").attr("class", name).attr("display", "none").selectAll("rect").data(major_data).enter().append("rect").attr("x", function (d, index) {
                if (index % 2 == 0)
                    return x;
                else
                    return data[index - 1] / (data[index - 1] + data[index]) * w + x;
            }).attr("width", function (d, index) {
                if (index % 2 == 0)
                    return d / (data[index + 1] + data[index]) * w;
                else
                    return d / (data[index - 1] + data[index]) * w;
            }).attr("y", function (d, index) {
                if (index / 2 < 1)
                    return y;
                else if (index / 2 < 2)
                    return (data[0] + data[1]) / d3.sum(data) * h + y;
                else
                    return h - (data[4] + data[5]) / d3.sum(data) * h + y;
            }).attr("height", function (d, index) {
                if (index / 2 < 1)
                    return (data[0] + data[1]) / d3.sum(data) * h;
                else if (index / 2 < 2)
                    return (data[2] + data[3]) / d3.sum(data) * h;
                else
                    return (data[4] + data[5]) / d3.sum(data) * h;
            }).attr("fill-opacity", function (d, index) {
                if (getDepartment(college_major_name[i]) == college_name)
                    return 0.8;
                else
                    return 0.8;
            }).attr("stroke-width", 0).attr("stroke", "gray").attr("stroke-opacity", 0.9).attr("fill", function (d, index) {
                if (getDepartment(college_major_name[i]) == college_name)
                    return "rgb(153, 204, 255)";
                else
                    return "rgb(255, 125, 92)";
            }).on("mouseover", function (d, index) {
                d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                $("#d3-tip").show();
                for (key in pre_major) {
                    if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                        continue;
                    else
                        d3.select("#d3-tip").html(key + "<br>" + " population:" + d + "<br>" + "% in major:" + (d / d3.sum(pre_major[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                }

            }).on("mouseout", function (d, index) {
                d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                $("#d3-tip").hide();

            });
        }

        var text = [college_name + "", "Good", "Normal", "Bad"];
        d3.select("#" + id).append("svg").selectAll("rect").data(text).enter().append("rect").attr("x", function (d, index) {
            if (index == 0)
                return x - width / 8 * 1 / 3;
            else
                return x - width / 8 * 1 / 6;
        }).attr("y", function (d, index) {
            if (index == 0 || index == 1)
                return y;
            else if (index == 2)
                return y + (data[0] + data[1]) / nums * (height - 25);
            else
                return y + (d3.sum(data) - data[4] - data[5]) / nums * (height - 25);

        }).attr("width", width / 8 * 1 / 6).attr("height", function (d, index) {
            if (index == 0)
                return d3.sum(data) / nums * (height - 25);
            else if (index == 1)
                return (data[0] + data[1]) / nums * (height - 25);
            else if (index == 2)
                return (data[2] + data[3]) / nums * (height - 25);
            else if (index == 3)
                return (data[4] + data[5]) / nums * (height - 25);
        }).attr("fill-opacity", 0.1).attr("stroke-width", 1).attr("stroke", "gray").attr("stroke-opacity", 0.9).attr("fill", "white");

        var temp = d3.select("#" + id).append("svg").selectAll("text").data(text).enter().append("text").attr("x", function (d, index) {
            if (index == 0)
                return x - width / 8 * 1 / 3 + width / 8 * 1 / 12;
            else
                return x - width / 8 * 1 / 6 + width / 8 * 1 / 12;
        }).attr("class", function (d, index) {
            if (index == 0)
                return "college_name";
            else
                return "fit";
        }).attr("y", function (d, index) {
            if (index == 0)
                return y + d3.sum(data) / nums * (height - 25) / 2 + 3;
            else if (index == 1)
                return y + (data[0] + data[1]) / nums * (height - 25) / 2 + 3;
            else if (index == 2)
                return y + (data[0] + data[1]) / nums * (height - 25) + (data[2] + data[3]) / nums * (height - 25) / 2 + 3;
            else
                return y + h - (data[4] + data[5]) / nums * (height - 25) / 2 + 2;

        }).text(function (d, index) {
            d = d.replace(/\s/g, '');
            return d.split('_').join(' ');

        }).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").style("writing-mode", "tb").attr("font-size", function (d, index) {
            if (index == 0)
                return 10;
            else
                return 7;
        }).attr("textLength", function (d, index) {
            if (index == 0)
                if (d3.select(this).node().getBBox().height >= d3.sum(data) / nums * (height - 25))
                    return d3.sum(data) / nums * (height - 25);

        }).attr("alignment-baseline", "middle");

        temp.text(function (d, index) {
            if (index == 0) {
                if (d3.select(this).node().getBBox().height > d3.sum(data) / nums * (height - 25))
                    return d.split('_').join(' ');
                else
                    return d.split('_').join(' ');
                ;
            } else if (index == 1) {
                if (d3.select(this).node().getBBox().height > (data[0] + data[1]) / nums * (height - 25))
                    return "G.";
                else
                    return d;
            } else if (index == 2) {
                if (d3.select(this).node().getBBox().height > (data[2] + data[3]) / nums * (height - 25))
                    return "N.";
                else
                    return d;
            } else if (index == 3) {
                if (d3.select(this).node().getBBox().height > (data[4] + data[5]) / nums * (height - 25))
                    return "B.";
                else
                    return d;
            }
        });
    }

    //data is the number of people in each department.
    function drawMajorTitle(data) {
        var title = [];
        for (key in department_major_tree) {
            title.push(department_major_tree[key]);
        }

        var h = 0;
        var text = d3.select("#majorTitle").selectAll("g").data(title);
        text.enter().append("g").attr("x", 0).attr("y", function (d, index) {
            h += data[index] / nums * height;
            return h - data[index] / nums * height;
        }).attr("id", function (d, index) {
            return "majorTitle" + index;
        });

        h = 0;
        var name;
        var mh = 0;

        for (var i = 0; i < title.length; i++) {

            mh = 0;
            d3.select("#majorTitle" + i).append("svg").selectAll("rect").data(title[i]).enter().append("rect").attr("x", 0).attr("y", function (d, index) {
                mh += d3.sum(pre_major[d]) / nums * (height - 25);
                return h + mh - d3.sum(pre_major[d]) / nums * (height - 25);
            }).attr("class", function (d, index) {
                name = d;
                name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                return name + "rect";
            }).attr("height", function (d, index) {
                if (d3.sum(pre_major[d]) / nums * (height - 25) < 1)
                    return 2;
                else
                    return d3.sum(pre_major[d]) / nums * (height - 25);
            }).on("mouseover", function (d, index) {

                for (key in pre_major) {
                    $("." + getDepartment(key)).hide();
                    name = key;
                    name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                    $("." + name).hide();
                    d3.select("." + name + "text").attr("font-size", function (d, index) {
                        if (d3.sum(pre_major[key]) / nums * height > 12)
                            return 12;
                        else if (d3.sum(pre_major[key]) / nums * height < 5)
                            return d3.sum(pre_major[key]) / nums * height;
                        else
                            return d3.sum(pre_major[key]) / nums * height;
                    }).attr("fill", "black");

                    d3.select("." + name + "rect").attr("fill", "gray").attr("fill-opacity", 0.1);
                }

                d3.select(this).attr("fill", "rgb(153, 204, 255)").attr("fill-opacity", 0.8);
                d3.select("." + d.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-') + "text").attr("fill", "white");

                $("." + getDepartment(d)).show();
                $("#d3-tip").show();
                d3.select("#d3-tip").html(d + "<br>" + " population:" + d3.sum(pre_major[d]) + "<br>" + "% in all:" + (d3.sum(pre_major[d]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                d = d.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                $("." + d).fadeIn("slow");

            }).on("mouseout", function (d, index) {
                $("#d3-tip").hide();
            }).attr("width", width / 7.5).attr("fill-opacity", 0.1).attr("stroke-width", 1).attr("stroke", "gray").attr("stroke-opacity", 0.9).attr("fill", "gray");

            mh = 0;
            text = d3.select("#majorTitle" + i).selectAll("text").data(title[i]).enter().append("text").attr("x", width / 15).attr("y", function (d, index) {
                if (d3.sum(pre_major[d]) / nums * (height - 25) < 1) {
                    mh += 2;
                    return h + mh - d3.sum(pre_major[d]) / nums * (height - 25) + 1;
                } else {
                    mh += d3.sum(pre_major[d]) / nums * (height - 25);
                    return h + mh - d3.sum(pre_major[d]) / nums * (height - 25) + d3.sum(pre_major[d]) / nums * (height - 25) / 2;
                }
            }).text(function (d) {
                return d;
            }).attr("alignment-baseline", "middle").attr("font-family", "sans-serif").attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("font-size", function (d, index) {
                if (d3.sum(pre_major[d]) / nums * height > 12)
                    return 12;
                else if (d3.sum(pre_major[d]) / nums * height < 5)
                    return d3.sum(pre_major[d]) / nums * height;
                else
                    return d3.sum(pre_major[d]) / nums * height;

            }).attr("textLength", function (d, index) {
                if (d3.select(this).node().getBBox().width > width / 8)
                    return width / 8;
            }).on("mouseover", function (d, index) {

                for (key in pre_major) {
                    $("." + getDepartment(key)).hide();
                    name = key;
                    name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                    $("." + name).hide();
                    d3.select("." + name + "text").attr("font-size", function (d, index) {
                        if (d3.sum(pre_major[key]) / nums * height > 12)
                            return 12;
                        else if (d3.sum(pre_major[key]) / nums * height < 5)
                            return d3.sum(pre_major[key]) / nums * height;
                        else
                            return d3.sum(pre_major[key]) / nums * height;
                    }).attr("fill", "black").attr("fill-opacity", 1);
                    d3.select("." + name + "rect").attr("fill", "gray").attr("fill-opacity", 0.1);
                }

                d3.select("." + d.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-') + "rect").attr("fill", "rgb(153, 204, 255)").attr("fill-opacity", 0.8);
                d3.select(this).attr("fill", "white");

                $("." + getDepartment(d)).show();
                $("#d3-tip").show();
                d3.select("#d3-tip").html(d + "<br>" + " population:" + d3.sum(pre_major[d]) + "<br>" + "% in all:" + (d3.sum(pre_major[d]) / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                d = d.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                $("." + d).fadeIn("slow");

            }).on("mouseout", function (d, index) {
                $("#d3-tip").hide();
            }).attr("class", function (d, index) {
                name = d;
                name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
                return name + "text";
            });

            h += 5 + data[i] / nums * (height - 25);
        }
    }

    //data is the number of people in each feature
    function drawFeatureBar(id, act_score_nums, act_score_text, x, ACT) {
        var name;
        var major;
        var i;
        var h = 0;
        var h1;

        d3.select("#" + id).append("svg").selectAll("rect").data(act_score_nums).enter().append("rect").attr("width", width / 29).attr("height", function (d, index) {
            return d / nums * height;
        }).attr("x", x).attr("y", function (d, index) {
            h += (act_score_nums[index] / nums * height);
            return h - act_score_nums[index] / nums * height;
        }).attr("fill", "gray").attr("fill-opacity", function (d, index) {
            return 0.1;
        }).attr("stroke-width", function (d, index) {
            return 1;
        }).attr("stroke-opacity", 0.9).attr("stroke", "gray").on("mouseover", function (d, index) {

        }).on("mouseout", function (d, index) {

        });

        for (key in ACT) {
            //initial
            h = 0;
            h1 = 0;
            major = [0, 0, 0, 0, 0, 0];
            name = key;
            name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            for (i = 0; i < ACT[key].length; i++) {
                major[Math.floor(i / 2)] += ACT[key][i];
            }

            d3.select("#" + id).append("svg").attr("class", name).attr("display", "none").selectAll("rect").data(major).enter().append("rect").attr("width", width / 29).attr("height", function (d, index) {
                return d / nums * height;
            }).attr("x", x).attr("y", function (d, index) {
                h1 += (act_score_nums[index] / nums * height);
                return h1 - d / nums * height;
            }).attr("fill", function (d, index) {
                return "rgb(153, 204, 255)";
            }).attr("fill-opacity", function (d, index) {
                return 0.8;
            }).attr("stroke-width", function (d, index) {

                return 0;
            }).attr("stroke-opacity", 0.9).attr("stroke", "gray").on("mouseover", function (d, index) {
                d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                $("#d3-tip").show();
                for (key in pre_major) {
                    if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                        continue;
                    else
                        d3.select("#d3-tip").html(key + "<br>" + " population:" + d + "<br>" + "% in major:" + (d / d3.sum(pre_major_switch[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                }
            }).on("mouseout", function (d, index) {
                d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                $("#d3-tip").hide();
            });
        }

        h = 0;
        d3.select("#" + id).selectAll("text").data(act_score_text).enter().append("text").text(function (d) {
            return d;
        }).attr("class", "score_text").attr("x", x + width / 29 / 2).attr("y", function (d, index) {
            h += (act_score_nums[index] / nums * height) + 1;
            return h - (act_score_nums[index] / nums * height) / 2;
        }).attr("font-family", "sans-serif").attr("font-size", 12).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("textLength", function (d, index) {
            if (d3.select(this).node().getBBox().width > width / 29)
                return width / 29;
        }).attr("alignment-baseline", "middle");

    }

    //	id 		indicate the svg block to draw stay and leave bar
    //	data[0] the total number of people leave the department
    //	x   	the x coordination of the bar
    function drawStayOrLeaveBar(id, data, x, MAJOR_SWITCH) {
        var text = ["stay", "leave"];
        var h = 0;
        var name;
        d3.select("#" + id).selectAll("rect").data(data).enter().append("rect").attr("x", x).attr("y", function (d, index) {

            if (index == 0)
                return 0;
            else
                return data[0] / nums * height;
        }).attr("width", width / 29).attr("height", function (d, index) {
            return data[index] / nums * height;
        }).attr("fill", function (d, index) {
            return "gray";
        }).attr("fill-opacity", function (d, index) {
            return 0.1;
        }).attr("stroke-width", function (d, index) {
            return 1;
        }).attr("stroke-opacity", 0.9).attr("stroke", "gray");

        for (key in MAJOR_SWITCH) {
            name = key;
            name = name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            d3.select("#" + id).append("svg").attr("class", name).attr("display", "none").selectAll("rect").data(MAJOR_SWITCH[key]).enter().append("rect").attr("x", x).attr("y", function (d, index) {

                if (index == 0)
                    return (data[0] - d) / nums * height;
                else
                    return height - d / nums * height;
            }).attr("width", width / 29).attr("height", function (d, index) {
                return d / nums * height;
            }).attr("fill", function (d, index) {
                if (index == 0)
                    return "rgb(153, 204, 255)";
                else
                    return "rgb(255, 125, 92)";
            }).attr("fill-opacity", function (d, index) {
                return 0.8;
            }).attr("stroke-width", 0).attr("stroke-opacity", 0.9).attr("stroke", "gray").on("mouseover", function (d, index) {
                d3.select(this).attr("stroke-width", 2).attr("fill-opacity", 1).attr("stroke", "gray");
                $("#d3-tip").show();
                for (key in pre_major) {
                    if ($("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).css("display") == "none")
                        continue;
                    else
                        d3.select("#d3-tip").html(key + "<br>" + " population:" + d + "<br>" + "% in major:" + (d / d3.sum(pre_major_switch[key]) * 100).toFixed(1) + "% <br>" + "% in all:" + (d / nums * 100).toFixed(1) + "%").style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY - 28) + "px");

                }
            }).on("mouseout", function (d, index) {
                d3.select(this).attr("stroke-width", 0).attr("fill-opacity", 0.8);
                $("#d3-tip").hide();
            });

        }

        d3.select("#" + id).selectAll("text").data(text).enter().append("text").attr("x", x + width / 29 / 2).attr("y", function (d, index) {
            if (index == 0) {
                return (data[0]) / nums * height / 2;
            } else {
                return height - (data[1]) / nums * height / 2;
            }
        }).attr("class", 'stay_leave_text').text(function (d) {
            return d;
        }).attr("font-family", "sans-serif").attr("font-size", 12).attr("lengthAdjust", "spacingAndGlyphs").style("text-anchor", " middle").attr("textLength", function (d, index) {
            if (d3.select(this).node().getBBox().width > width / 29)
                return width / 29;
        }).attr("alignment-baseline", "middle");

    }

    function dataInitialization(data) {
        activeColor = ["green", "pink", "orange", "burlywood", "blue", "purple"];

        actcat = {
            "1-15": 0,
            "16-19": 0,
            "20-23": 0,
            "24-27": 0,
            "28-32": 0,
            "33-36": 0
        };

        fre_switch = {
            "stay": 0,
            "leave": 0
        };
        sop_switch = {
            "stay": 0,
            "leave": 0
        };

        transfer = {
            "yes": 0,
            "no": 0
        };

        pre_college = {
            "Health": [0, 0, 0, 0, 0, 0],
            "Business": [0, 0, 0, 0, 0, 0],
            "Humanities": [0, 0, 0, 0, 0, 0],
            "Education_Service": [0, 0, 0, 0, 0, 0],
            "Engineering_Tech": [0, 0, 0, 0, 0, 0],
            "Science_Math": [0, 0, 0, 0, 0, 0]
        };

        fre_college = {
            "Health": [0, 0, 0, 0, 0, 0],
            "Business": [0, 0, 0, 0, 0, 0],
            "Humanities": [0, 0, 0, 0, 0, 0],
            "Education_Service": [0, 0, 0, 0, 0, 0],
            "Engineering_Tech": [0, 0, 0, 0, 0, 0],
            "Science_Math": [0, 0, 0, 0, 0, 0]
        };

        sop_college = {
            "Health": [0, 0, 0, 0, 0, 0],
            "Business": [0, 0, 0, 0, 0, 0],
            "Humanities": [0, 0, 0, 0, 0, 0],
            "Education_Service": [0, 0, 0, 0, 0, 0],
            "Engineering_Tech": [0, 0, 0, 0, 0, 0],
            "Science_Math": [0, 0, 0, 0, 0, 0]
        };

        department_major_tree = {
            "Health": [],
            "Business": [],
            "Humanities": [],
            "Education_Service": [],
            "Engineering_Tech": [],
            "Science_Math": []
        };

        pre_department = {
            "Health": 0,
            "Business": 0,
            "Humanities": 0,
            "Education_Service": 0,
            "Engineering_Tech": 0,
            "Science_Math": 0
        };

        fre_department = {
            "Health": 0,
            "Business": 0,
            "Humanities": 0,
            "Education_Service": 0,
            "Engineering_Tech": 0,
            "Science_Math": 0
        };

        sop_department = {
            "Health": 0,
            "Business": 0,
            "Humanities": 0,
            "Education_Service": 0,
            "Engineering_Tech": 0,
            "Science_Math": 0
        };

        health_science_major_leave = {
            "Health": 0,
            "Business": 0,
            "Humanities": 0,
            "Education_Service": 0,
            "Engineering_Tech": 0,
            "Science_Math": 0
        };

        health_science_major_leave_sop = {
            "Health": 0,
            "Business": 0,
            "Humanities": 0,
            "Education_Service": 0,
            "Engineering_Tech": 0,
            "Science_Math": 0
        };

        pre_gender = {
            "Health": [0, 0],
            "Business": [0, 0],
            "Humanities": [0, 0],
            "Education_Service": [0, 0],
            "Engineering_Tech": [0, 0],
            "Science_Math": [0, 0]
        };

        fre_gender = {
            "Health": [0, 0],
            "Business": [0, 0],
            "Humanities": [0, 0],
            "Education_Service": [0, 0],
            "Engineering_Tech": [0, 0],
            "Science_Math": [0, 0]
        };

        sop_gender = {
            "Health": [0, 0],
            "Business": [0, 0],
            "Humanities": [0, 0],
            "Education_Service": [0, 0],
            "Engineering_Tech": [0, 0],
            "Science_Math": [0, 0]
        };

        //index 0 indicate 2 year, index 1 indicate 4 year.
        fre_yr = {
            "Health": [0, 0],
            "Business": [0, 0],
            "Humanities": [0, 0],
            "Education_Service": [0, 0],
            "Engineering_Tech": [0, 0],
            "Science_Math": [0, 0]
        };

        sop_yr = {
            "Health": [0, 0],
            "Business": [0, 0],
            "Humanities": [0, 0],
            "Education_Service": [0, 0],
            "Engineering_Tech": [0, 0],
            "Science_Math": [0, 0]
        };

        pre_major_imfit = {
            "Health": [0, 0, 0],
            "Business": [0, 0, 0],
            "Humanities": [0, 0, 0],
            "Education_Service": [0, 0, 0],
            "Engineering_Tech": [0, 0, 0],
            "Science_Math": [0, 0, 0]
        };

        fre_major_imfit = {
            "Health": [0, 0, 0],
            "Business": [0, 0, 0],
            "Humanities": [0, 0, 0],
            "Education_Service": [0, 0, 0],
            "Engineering_Tech": [0, 0, 0],
            "Science_Math": [0, 0, 0]
        };

        sop_major_imfit = {
            "Health": [0, 0, 0],
            "Business": [0, 0, 0],
            "Humanities": [0, 0, 0],
            "Education_Service": [0, 0, 0],
            "Engineering_Tech": [0, 0, 0],
            "Science_Math": [0, 0, 0]
        };
        {
            fre_health = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            fre_business = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            fre_humanity = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            fre_education = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            fre_engineer = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            fre_science = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
        }
        {
            sop_health = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            sop_business = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            sop_humanity = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            sop_education = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            sop_engineer = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
            sop_science = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };
        }

        fre_college_switch = {
            "Health": fre_health,
            "Business": fre_business,
            "Humanities": fre_humanity,
            "Education_Service": fre_education,
            "Engineering_Tech": fre_engineer,
            "Science_Math": fre_science
        };

        sop_college_switch = {
            "Health": sop_health,
            "Business": sop_business,
            "Humanities": sop_humanity,
            "Education_Service": sop_education,
            "Engineering_Tech": sop_engineer,
            "Science_Math": sop_science
        };
        {
            pre_major = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };

            ACT = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            };

            pre_major_switch = {
                "Agric. & Nat. Res. Cons": [0, 0],
                "Architecture": [0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0],
                "Arts: Visual & Performing": [0, 0],
                "Business": [0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0],
                "Communications": [0, 0],
                "Comp. Sci. & Mathematics": [0, 0],
                "Education": [0, 0],
                "Eng. Tech. & Drafting": [0, 0],
                "Engineering": [0, 0],
                "English & Foreign Lang.": [0, 0],
                "Health Admin. & Assisting": [0, 0],
                "Health Sci. & Techno.": [0, 0],
                "Philosophy, Religion, & Theology": [0, 0],
                "Repair, Production, & Construction": [0, 0],
                "Sciences: Biological & Physical": [0, 0],
                "Social Sciences & Law": [0, 0]
            };

            fre_major_switch = {
                "Agric. & Nat. Res. Cons": [0, 0],
                "Architecture": [0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0],
                "Arts: Visual & Performing": [0, 0],
                "Business": [0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0],
                "Communications": [0, 0],
                "Comp. Sci. & Mathematics": [0, 0],
                "Education": [0, 0],
                "Eng. Tech. & Drafting": [0, 0],
                "Engineering": [0, 0],
                "English & Foreign Lang.": [0, 0],
                "Health Admin. & Assisting": [0, 0],
                "Health Sci. & Techno.": [0, 0],
                "Philosophy, Religion, & Theology": [0, 0],
                "Repair, Production, & Construction": [0, 0],
                "Sciences: Biological & Physical": [0, 0],
                "Social Sciences & Law": [0, 0]
            };

            fre_major = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };

            sop_major = {
                "Agric. & Nat. Res. Cons": [0, 0, 0, 0, 0, 0],
                "Architecture": [0, 0, 0, 0, 0, 0],
                "Area, Eth. & Multidiscip. Studies": [0, 0, 0, 0, 0, 0],
                "Arts: Visual & Performing": [0, 0, 0, 0, 0, 0],
                "Business": [0, 0, 0, 0, 0, 0],
                "Commun, Fam., & Personal Svcs": [0, 0, 0, 0, 0, 0],
                "Communications": [0, 0, 0, 0, 0, 0],
                "Comp. Sci. & Mathematics": [0, 0, 0, 0, 0, 0],
                "Education": [0, 0, 0, 0, 0, 0],
                "Eng. Tech. & Drafting": [0, 0, 0, 0, 0, 0],
                "Engineering": [0, 0, 0, 0, 0, 0],
                "English & Foreign Lang.": [0, 0, 0, 0, 0, 0],
                "Health Admin. & Assisting": [0, 0, 0, 0, 0, 0],
                "Health Sci. & Techno.": [0, 0, 0, 0, 0, 0],
                "Philosophy, Religion, & Theology": [0, 0, 0, 0, 0, 0],
                "Repair, Production, & Construction": [0, 0, 0, 0, 0, 0],
                "Sciences: Biological & Physical": [0, 0, 0, 0, 0, 0],
                "Social Sciences & Law": [0, 0, 0, 0, 0, 0]
            };

        }

        var sum = 0;
        major_name = Object.keys(pre_major).map(function (value) {
            return [value];
        });

        department_name = Object.keys(pre_department).map(function (value) {
            return [value];
        });

        //skip the label line
        for (var i = 1; i < data.length; i++) {

            fre_college_switch[getDepartment(data[i][3])][data[i][2]][get_gender_imfit(data[i], 6)] += parseInt(data[i][12]);
            if (getDepartment(data[i][2]) == getDepartment(data[i][3]))
                sop_college_switch[getDepartment(data[i][4])][data[i][3]][get_gender_imfit(data[i], 7)] += parseInt(data[i][12]);

            if (data[i][0] == "Male") {
                if (data[i][5] == "Good") {
                    pre_college[getDepartment(data[i][2])][0] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][0] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][0] += parseInt(data[i][12]);

                    pre_major[data[i][2]][0] += parseInt(data[i][12]);
                    fre_major[data[i][3]][0] += parseInt(data[i][12]);
                    sop_major[data[i][4]][0] += parseInt(data[i][12]);
                } else if (data[i][5] == "Moderate") {
                    pre_college[getDepartment(data[i][2])][2] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][2] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][2] += parseInt(data[i][12]);

                    pre_major[data[i][2]][2] += parseInt(data[i][12]);
                    fre_major[data[i][3]][2] += parseInt(data[i][12]);
                    sop_major[data[i][4]][2] += parseInt(data[i][12]);
                } else {
                    pre_college[getDepartment(data[i][2])][4] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][4] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][4] += parseInt(data[i][12]);

                    pre_major[data[i][2]][4] += parseInt(data[i][12]);
                    fre_major[data[i][3]][4] += parseInt(data[i][12]);
                    sop_major[data[i][4]][4] += parseInt(data[i][12]);
                }
            } else {
                if (data[i][5] == "Good") {
                    pre_college[getDepartment(data[i][2])][1] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][1] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][1] += parseInt(data[i][12]);

                    pre_major[data[i][2]][1] += parseInt(data[i][12]);
                    fre_major[data[i][3]][1] += parseInt(data[i][12]);
                    sop_major[data[i][4]][1] += parseInt(data[i][12]);
                } else if (data[i][5] == "Moderate") {
                    pre_college[getDepartment(data[i][2])][3] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][3] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][3] += parseInt(data[i][12]);

                    pre_major[data[i][2]][3] += parseInt(data[i][12]);
                    fre_major[data[i][3]][3] += parseInt(data[i][12]);
                    sop_major[data[i][4]][3] += parseInt(data[i][12]);
                } else {
                    pre_college[getDepartment(data[i][2])][5] += parseInt(data[i][12]);
                    fre_college[getDepartment(data[i][3])][5] += parseInt(data[i][12]);
                    sop_college[getDepartment(data[i][4])][5] += parseInt(data[i][12]);

                    pre_major[data[i][2]][5] += parseInt(data[i][12]);
                    fre_major[data[i][3]][5] += parseInt(data[i][12]);
                    sop_major[data[i][4]][5] += parseInt(data[i][12]);
                }
            }

            //pre_major switch
            if (getDepartment(data[i][2]) == getDepartment(data[i][3])) {
                pre_major_switch[data[i][2]][0] += parseInt(data[i][12]);

            } else {
                pre_major_switch[data[i][2]][1] += parseInt(data[i][12]);
            }

            //fre_major switch
            if (getDepartment(data[i][2]) == getDepartment(data[i][3])) {
                if (getDepartment(data[i][3]) == getDepartment(data[i][4]))
                    fre_major_switch[data[i][3]][0] += parseInt(data[i][12]);
                else
                    fre_major_switch[data[i][3]][1] += parseInt(data[i][12]);
            }

            sum += parseInt(data[i][12]);

            if (data[i][0] == "Female") {
                pre_gender[getDepartment(data[i][2])][1] += parseInt(data[i][12]);
                fre_gender[getDepartment(data[i][3])][1] += parseInt(data[i][12]);
                sop_gender[getDepartment(data[i][4])][1] += parseInt(data[i][12]);
            } else {
                pre_gender[getDepartment(data[i][2])][0] += parseInt(data[i][12]);
                fre_gender[getDepartment(data[i][3])][0] += parseInt(data[i][12]);
                sop_gender[getDepartment(data[i][4])][0] += parseInt(data[i][12]);
            }

            //act score and stay and leave status in the first year.
            actcat[data[i][1]] += parseInt(data[i][12]);
            if (getDepartment(data[i][2]) == getDepartment(data[i][3]))
                ACT[data[i][2]][getactIndex(data[i][1]) * 2] += parseInt(data[i][12]);
            else
                ACT[data[i][2]][getactIndex(data[i][1]) * 2 + 1] += parseInt(data[i][12]);

            pre_major_imfit[getDepartment(data[i][2])][getImfit(data[i][5])] += parseInt(data[i][12]);
            fre_major_imfit[getDepartment(data[i][3])][getImfit(data[i][6])] += parseInt(data[i][12]);
            sop_major_imfit[getDepartment(data[i][4])][getImfit(data[i][7])] += parseInt(data[i][12]);

            //switch department freshman
            if (getDepartment(data[i][2]) == getDepartment(data[i][3])) {
                fre_switch["stay"] += parseInt(data[i][12]);
            } else {
                fre_switch["leave"] += parseInt(data[i][12]);
            }

            //swithc department sophomore
            if (getDepartment(data[i][3]) == getDepartment(data[i][4])) {
                sop_switch["stay"] += parseInt(data[i][12]);
            } else {
                sop_switch["leave"] += parseInt(data[i][12]);
            }
        }

        for (key in pre_major) {
            pre_department[getDepartment(key)] += d3.sum(pre_major[key]);
            fre_department[getDepartment(key)] += d3.sum(fre_major[key]);
            sop_department[getDepartment(key)] += d3.sum(sop_major[key]);
        }

        for (var i = 0; i < major_name.length; i++) {
            department_major_tree[getDepartment(major_name[i][0])].push(major_name[i][0]);
        }

        return sum;

    }

    function get_gender_imfit(data, index) {
        if (data[0] == "Male") {
            if (data[index] == "Good")
                return 0;
            else if (data[index] == "Moderate")
                return 2;
            else
                return 4;
        } else {
            if (data[index] == "Good")
                return 1;
            else if (data[index] == "Moderate")
                return 3;
            else
                return 5;
        }
    }

    function getImfit(fit) {
        switch (fit) {
            case "Good":
                return 0;
            case "Moderate":
                return 1;
            case "Poor":
                return 2;
            default:
                throw "unknow imfit";
        }
    }

    function getactIndex(act) {
        switch (act) {
            case "1-15":
                return 0;
            case "16-19":
                return 1;
            case "20-23":
                return 2;
            case "24-27":
                return 3;
            case "28-32":
                return 4;
            case "33-36":
                return 5;
        }
    }

    function getMajor_Y_Location(major, department_container, major_container) {
        var sum = 0;
        var college;
        for (key in department_container) {
            if (getDepartment(major) == key) {
                college = department_major_tree[getDepartment(major)];
                for (var i = 0; i < college.length; i++)
                    if (major == college[i])
                        return sum;
                    else
                        sum += d3.sum(major_container[college[i]]) / nums * (height - 25);

                throw "error";
            } else {
                sum += department_container[key] / nums * (height - 25) + 5;
            }
        }
    }

    function getDepartment(major) {
        switch (major) {
            case major_name[13][0]:
            case major_name[12][0]:
                return "Health";
            case major_name[4][0]:
                return "Business";
            case major_name[6][0]:
            case major_name[17][0]:
            case major_name[11][0]:
            case major_name[14][0]:
            case major_name[3][0]:
                return "Humanities";
            case major_name[7][0]:
            case major_name[16][0]:
            case major_name[0][0]:
            case major_name[2][0]:
                return "Science_Math";
            case major_name[5][0]:
            case major_name[8][0]:
                return "Education_Service";
            case major_name[10][0]:
            case major_name[9][0]:
            case major_name[1][0]:
            case major_name[15][0]:
                return "Engineering_Tech";
            default:
                throw "Unknow Major";
        }
    }

    function tipToolevent() {
        $("#example1").click(function () {
            for (key in pre_major) {
                $("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).hide();
            }

            var name = "Health Sci. & Techno.";
            $("." + name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).show();
        });

        $("#example2").click(function () {
            for (key in pre_major) {
                $("." + key.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).hide();
            }

            var name = "Arts: Visual & Performing";
            $("." + name.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-')).show();
        });
    }
</script>

</body>
</html>
